<!DOCTYPE html>
<html lang="pt">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="author" content="Antônio Vinícius Menezes Medeiros">
    <meta name="description" content="É verdade que quando criamos um disco rígido virtual dinamicamente alocado no VirtualBox, ele cresce à medida em que arquivos são gravados. No entanto, seu t...">

    <link rel="apple-touch-icon" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">
    <link rel="shortcut icon" href="/img/favicon.png">

    <title>Reduzindo o tamanho de discos r&iacute;gidos virtuais do VirtualBox - vinyanalista.com.br</title>

    <!-- Bootstrap core CSS -->
    <link href="/lib/paper/3.3.4/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/css/comum.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/lib/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="/lib/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--<link rel="stylesheet" href="/css/main.css">-->
    <link rel="canonical" href="http://vinyanalista.github.io/blog/2014/01/20/reduzindo-o-tamanho-de-discos-rigidos-virtuais-do-virtualbox/">
    <link rel="alternate" type="application/rss+xml" title="vinyanalista.com.br" href="http://vinyanalista.github.io/feed.xml" />
</head>
    <body>
        <!-- Fixed navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Exibir/esconder</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">vinyanalista.com.br</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li>
                    <a href="/">Blog</a>
                </li>
                <li>
                    <a href="/blog/category/trabalhos/">Trabalhos</a>
                </li>
                <li>
                    <a href="http://lattes.cnpq.br/2162371468280338">Currículo</a>
                </li>
            </ul>
            
            <form class="navbar-form navbar-right" role="search">
                <div class="input-group" id="grupo_pesquisar">
                    <input type="text" class="form-control"  name="q" placeholder="Pesquisar" />
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </div>
                </div>
            </form>
            
        </div><!-- #navbar -->
    </div><!-- .container -->
</nav>
        <div class="container">
            <div class="row">
                <div class='col-sm-8' id='blog-principal'>
                    <div class="blog-post panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-titulo">
            <a href="">Reduzindo o tamanho de discos r&iacute;gidos virtuais do VirtualBox</a>
        </h2>
        <div class="blog-post-meta row">
            <div class='col-sm-6'>
                <div class='blog-post-data'>
                    20 de
                    
                    Janeiro
                    
                    de 2014
                </div>
            </div>
            <div class='col-sm-6'>
                <div class='blog-post-redes-sociais'>
                    Fa &nbsp Tw &nbsp G+ &nbsp +
                </div>
            </div>
        </div>
    </div>
    <div class="blog-post-conteudo panel-body">
        <p>É verdade que quando criamos um disco rígido virtual dinamicamente alocado no <a href="http://www.virtualbox.org/">VirtualBox</a>, ele cresce à medida em que arquivos são gravados. No entanto, seu tamanho não diminui à medida em que excluímos arquivos. Veja agora como é possível reduzir discos rígidos desse tipo no VirtualBox.</p>

<p class="text-center">
    <a href="/files/2014/01/virtualbox.png" title="">
        <img src="/files/2014/01/virtualbox.png" alt="" class="img-responsive img-thumbnail" />
    </a>
</p>

<!--more-->

<p>Primeiro, é necessário executar um utilitário na <strong>máquina virtual</strong> (<em>guest</em>), que vai transformar todo o espaço livre em <em>bits</em> zero no disco rígido virtual. Se sua máquina virtual roda Linux, esse utilitário é o <strong>zerofree</strong>, se roda Windows, há o <strong>SDelete</strong>.</p>

<p>A <a href="http://www.thelinuxdaily.com/2010/02/shrinking-a-dynamic-virtualbox-disk-image/">página na qual descobri o zerofree</a> recomenda reiniciar o Linux (da máquina virtual) no modo de recuperação (<em>safe mode</em> ou <em>recovery mode</em>) para executar o <strong>zerofree</strong>. Pra simplificar a vida, eu prefiro inicializar a máquina virtual utilizando um LiveCD.</p>

<p>Se você tiver um LiveCD do Ubuntu, o <strong>zerofree</strong> pode ser instalado nele via:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># apt-get install zerofree</span></code></pre></div>

<p>O openSUSE também possui o <strong>zerofree</strong> nos repositórios oficiais da distribuição:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># zypper in zerofree</span></code></pre></div>

<p>Se for usar o LiveCD de outra distribuição, pesquise na Internet como obter o <strong>zerofree</strong> para a sua distribuição.</p>

<p>Se você não souber identificar o disco rígido, o utilitário <strong>fdisk</strong> pode dar uma pista:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># fdisk -l</span></code></pre></div>

<p>No meu caso, vou compactar o <strong>/dev/sda1</strong>.</p>

<p>Montamos o disco rígido como somente leitura em uma pasta temporária e executamos o <strong>zerofree</strong> nele:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># mkdir /mnt/tmp</span>
<span class="c"># mount -o ro /dev/sda1 /mnt/tmp</span>
<span class="c"># zerofree /dev/sda1</span></code></pre></div>

<p>Se sua máquina virtual roda Windows, você deve baixar o <a href="http://technet.microsoft.com/en-us/sysinternals/bb897443.aspx">SDelete</a>, abrir o Prompt de Comando, ir até a pasta onde o <strong>SDelete</strong> foi baixado e executar o comando:</p>

<div class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="p">&gt;</span> <span class="n">sdelete</span> <span class="n">-c</span> <span class="n">C</span><span class="err">:</span><span class="p">/</span></code></pre></div>

<p>Onde <strong>C</strong> é a letra da unidade cujo espaço livre deseja-se converter em <strong>bits</strong> zero.</p>

<p>Após executar o <strong>zerofree</strong> ou o <strong>SDelete</strong>, devemos voltar à <strong>máquina real</strong> (<em>host</em>) e executar o utilitário do VirtualBox que vai de fato compactar o disco rígido virtual, reduzindo seu tamanho fisicamente.</p>

<p>Se sua máquina real roda Linux:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>VBoxManage modifyhd /caminho/para/o/hd/virtual.vdi --compact</code></pre></div>

<p>Se sua máquina real roda Windows, provavelmente você terá que ir até a pasta do VirtualBox para executar o comando:</p>

<div class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="p">&gt;</span> <span class="n">cd</span> <span class="s2">&quot;C:\Program Files\Oracle\VirtualBox&quot;</span>
<span class="p">&gt;</span> <span class="n">VBoxManage</span> <span class="n">modifyhd</span> <span class="s2">&quot;C:\caminho\para\o\hd\virtual.vdi&quot;</span> <span class="p">-</span><span class="n">-compact</span></code></pre></div>

<p>Foi assim que hoje consegui reduzir um disco rígido virtual de 6,5GB para 5GB. Foi uma redução pequena, mas isso varia de um caso para outro. O autor <a href="http://www.maketecheasier.com/shrink-your-virtualbox-vm">desse post no Make Tech Easier</a> conseguiu uma redução de 45% no espaço que o disco rígido virtual ocupava (de 10GB para 5,5GB).</p>

<p>Abraço a todos e até mais!</p>

<h3 id="referncias">Referências</h3>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td>[Shrinking a Dynamic VirtualBox Disk Image</td>
          <td>The Linux Daily](http://www.thelinuxdaily.com/2010/02/shrinking-a-dynamic-virtualbox-disk-image/)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><a href="http://www.maketecheasier.com/shrink-your-virtualbox-vm">How To Shrink Your Virtualbox VM And Free Up Space For Your Hard Disk – Make Tech Easier</a></li>
</ul>

    </div><!-- .blog-post-conteudo -->
</div><!-- .blog-post -->
                </div><!-- #blog-principal -->
                <div class="col-sm-4" id="blog-lateral">
                    <div class="panel panel-default" id='sobre'>
    <div class="panel-heading">
        <h4>Sobre mim</h4>
    </div>
    <div class="panel-body">
        <p>
        Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.
    </p>
    </div>
</div>

<div class="panel panel-default" id='arquivos'>
    <div class="panel-heading">
        <h4>Arquivos</h4>
    </div>
    <div class="panel-body">
        <ol class="list-unstyled">
            <li>
                <a href="#">March 2014</a>
            </li>
            <li>
                <a href="#">February 2014</a>
            </li>
            <li>
                <a href="#">January 2014</a>
            </li>
            <li>
                <a href="#">December 2013</a>
            </li>
            <li>
                <a href="#">November 2013</a>
            </li>
            <li>
                <a href="#">October 2013</a>
            </li>
            <li>
                <a href="#">September 2013</a>
            </li>
            <li>
                <a href="#">August 2013</a>
            </li>
            <li>
                <a href="#">July 2013</a>
            </li>
            <li>
                <a href="#">June 2013</a>
            </li>
            <li>
                <a href="#">May 2013</a>
            </li>
            <li>
                <a href="#">April 2013</a>
            </li>
        </ol>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h4>Elsewhere</h4>
    </div>
    <div class="panel-body">
        <ol class="list-unstyled">
            <li>
                <a href="https://facebook.com/vinyanalista">Facebook</a>
            </li>
            <li>
                <a href="https://github.com/vinyanalista">GitHub</a>
            </li>
            <li>
                <a href="https://twitter.com/vinyanalista">Twitter</a>
            </li>
        </ol>
    </div>
</div>
                </div><!-- #blog-lateral -->
            </div>
        </div>
        <footer class="footer">
    <div class="container text-center">
        Copyright © 2015. <a href='#sobre'>Antônio Vinícius Menezes Medeiros</a>. Todos os direitos reservados. Blog construído sobre o <a href="http://jekyllrb.com/" target='_blank'>Jekyll</a>. Tema <a href="https://bootswatch.com/paper/" target='_blank'>Paper</a>.
    </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/lib/jquery/1.11.3/jquery-1.11.3.min.js"></script>
<script src="/lib/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/lib/bootstrap/3.3.4/js/ie10-viewport-bug-workaround.js"></script>
    </body>
</html>