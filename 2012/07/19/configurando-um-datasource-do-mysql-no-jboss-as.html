<!DOCTYPE html>
<html lang="pt">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="author" content="Antônio Vinícius Menezes Medeiros">
    <meta name="description" content="O MySQL é um banco de dados de código aberto desenvolvido pela Oracle. Ele se tornou um dos bancos de dados mais utilizados no mundo devido ao fato de se int...">

    <link rel="apple-touch-icon" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">
    <link rel="shortcut icon" href="/img/favicon.png">

    <title>Configurando um datasource do MySQL no JBoss AS - vinyanalista.com.br</title>

    <!-- Bootstrap core CSS -->
    <link href="/lib/paper/3.3.4/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/css/comum.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/lib/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="/lib/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--<link rel="stylesheet" href="/css/main.css">-->
    <link rel="canonical" href="http://vinyanalista.github.io/2012/07/19/configurando-um-datasource-do-mysql-no-jboss-as.html">
    <link rel="alternate" type="application/rss+xml" title="vinyanalista.com.br" href="http://vinyanalista.github.io/feed.xml" />
</head>
    <body>
        <!-- Fixed navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Exibir/esconder</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">vinyanalista.com.br</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li>
                    <a href="#about">Trabalhos</a>
                </li>
                <li>
                    <a href="http://lattes.cnpq.br/2162371468280338">Currículo</a>
                </li>
            </ul>
            
            <form class="navbar-form navbar-right" role="search">
                <div class="input-group" id="grupo_pesquisar">
                    <input type="text" class="form-control"  name="q" placeholder="Pesquisar" />
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </div>
                </div>
            </form>
            
        </div><!-- #navbar -->
    </div><!-- .container -->
</nav>
        <div class="container">
            <div class="row">
                <div class='col-sm-8' id='blog-principal'>
                    <div class="blog-post panel panel-default">
    <div class="panel-heading">
        <h2 class="blog-post-titulo">
            <a href="">Configurando um datasource do MySQL no JBoss AS</a>
        </h2>
        <div class="blog-post-meta row">
            <div class='col-sm-6'>
                <div class='blog-post-data'>
                    19 de
                    
                    Julho
                    
                    de 2012
                </div>
            </div>
            <div class='col-sm-6'>
                <div class='blog-post-redes-sociais'>
                    Fa &nbsp Tw &nbsp G+ &nbsp +
                </div>
            </div>
        </div>
    </div>
    <div class="blog-post-conteudo panel-body">
        <p>O <a href="http://www.mysql.com/">MySQL</a> é um banco de dados de código aberto desenvolvido pela <a href="http://www.oracle.com/">Oracle</a>. Ele se tornou um dos bancos de dados mais utilizados no mundo devido ao fato de se integrar perfeitamente ao <a href="http://www.php.net/">PHP</a>, sendo oferecido pela maioria dos serviços de hospedagem de sites em conjunto com o suporte a essa linguagem. Nesse post, você verá como utilizá-lo em conjunto com o servidor de aplicação <a href="http://www.jboss.org/jbossas/">JBoss AS</a> para satisfazer as necessidades de armazenamento de dados de suas aplicações <a href="http://www.oracle.com/technetwork/java/javaee/">Java EE</a>.</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_01.jpg" alt="jboss_as_mysql_01" /></p>

<p>Aqui também há uma dica para usuários do banco de dados <a href="http://www.postgresql.org/">PostgreSQL</a> que quiserem fazer o mesmo: leiam o final do post!</p>

<!--more-->

<p>No <a href="/2012/07/18/apresentando-o-servidor-de-aplicacao-jboss-as-7.html">post anterior</a>, você foi apresentado ao JBoss AS. Nesse post, veremos como configurar nele uma conexão com o MySQL, e veremos também como configurar uma aplicação Java EE para utilizar essa conexão. Para fins didáticos, vou supor que você possui o JBoss AS e o MySQL instalados em seu computador, e que você criou uma base de dados chamada “teste” (para esse passo-a-passo a estrutura da base de dados não é importante, focaremos na conexão).</p>

<p>Há outras páginas na Internet que explicam exatamente o que vou explicar aqui (como <a href="https://zorq.net/b/2011/07/12/adding-a-mysql-datasource-to-jboss-as-7/">essa</a>, <a href="http://www.messiasbittencourt.com/168/jboss-7-mysql/">essa</a>, <a href="http://filosofisto.wordpress.com/2012/02/13/configurando-mysql-no-jboss-7-as/">essa</a> e <a href="http://jbossdivers.wordpress.com/2012/01/20/introducao-ao-jboss-as-7-parte-2/">essa</a>, e aproveito para dizer que essas foram algumas das minhas referências na elaboração desse post), porém aqui proponho uma abordagem diferente, que só percebi que era possível quando li mais atentamente o <a href="https://docs.jboss.org/author/display/AS7/Admin+Guide#AdminGuide-Datasources">guia de administração do JBoss AS</a> (a referência que encerra a lista): realizar toda a configuração da conexão pelo console Web de administração do servidor.</p>

<p>Dividirei a explicação em 3 etapas: fazer deploy do driver JDBC, criação do datasource e configurar a aplicação Web para utilizar esse datasource. As explicações aqui fornecidas se aplicam a qualquer sistema operacional onde seja possível executar o JBoss AS.</p>

<h3 id="deploy-do-driver-jdbc-do-mysql">Deploy do driver JDBC do MySQL</h3>

<p>Em primeiro lugar, precisamos do driver JDBC do MySQL. Ele é distribuído como um pacote no site do MySQL (os desenvolvedores do MySQL chamam seu driver JDBC de “MySQL Connector/J”), juntamente com seus código-fonte e documentação.</p>

<p>Entre na <a href="http://www.mysql.com/downloads/connector/j/">página de downloads do MySQL Connector/J</a> e baixe um dos pacotes disponíveis. Para os usuários de Windows, eu recomendo o download do arquivo <strong>.zip</strong>, e para os usuários de Linux, eu recomendo o download do arquivo <strong>.tar.gz</strong>. Descompacte o conteúdo do arquivo baixado para uma pasta de fácil acesso. Para demonstração, utilizarei o Linux, e baixarei o arquivo para minha pasta pessoal (“/home/vinicius/”):</p>

<p>Quando o conteúdo do arquivo é extraído, é criada uma pasta “mysql-connector-java-5.1.21″. Dentro dessa pasta, está o arquivo “mysql-connector-java-5.1.21-bin.jar”. Implante esse arquivo no servidor utilizando o console Web de administração do JBoss AS, exatamente como descrito na <a href="/2012/07/18/apresentando-o-servidor-de-aplicacao-jboss-as-7-parte-2.html">segunda parte do post anterior</a>.</p>

<p>Ao final do processo, o driver JDBC do MySQL deve aparecer habilitado na lista de aplicações implantadas, como mostra a figura (curiosamente, a <a href="http://www.jboss.org/jdf/quickstarts/jboss-as-quickstart/helloworld-jsf/">aplicação de exemplo</a> que implantamos <a href="/2012/07/18/apresentando-o-servidor-de-aplicacao-jboss-as-7-parte-2.html">naquele post</a> ainda está no servidor):</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_02.jpg" alt="jboss_as_mysql_02" /></p>

<h3 id="criao-do-datasource">Criação do datasource</h3>

<p>No painel superior do console Web, clique em “Profile”, e em seguida, no menu da esquerda, clique em “Datasources”. É exibida uma lista com todos os datasources configurados (nesse caso, só há o <a href="https://docs.jboss.org/author/display/AS7/Getting+Started+Guide#GettingStartedGuide-ModifyingtheExampleDataSource">datasource de exemplo</a>, que já vem configurado com o servidor de aplicação):</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_03.jpg" alt="jboss_as_mysql_03" /></p>

<p>Clique em “Add”. Na caixa de diálogo que aparece, forneça ao datasource um nome (esse nome não afeta a conexão, serve apenas para distinguir o datasource na lista, aqui forneci “TesteDS”) e um nome <a href="http://www.oracle.com/technetwork/java/jndi/">JNDI</a> (esse sim importa à conexão, é usado para localizar um recurso na rede e deve começar sempre com “java:/” ou “java:jboss/”, aqui digitei “java:/teste”), e em seguida clique em “Next”:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_04.jpg" alt="jboss_as_mysql_04" /></p>

<p>Selecione um driver JDBC na lista de drivers disponíveis. No nosso caso, devemos selecionar o MySQL Connector/J. Depois clique em “Next”:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_05.jpg" alt="jboss_as_mysql_05" /></p>

<p>Finalmente, devemos informar os detalhes da conexão: o endereço JDBC de acesso ao banco (aqui, preenchi com “jdbc:mysql://localhost:3306/teste”, o formato desse endereço é “jdbc:mysql://servidor:porta/base”), o usuário e a senha que serão utilizados. Depois de preencher os campos, clique em “Done”:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_06.jpg" alt="jboss_as_mysql_06" /></p>

<p>O datasource é criado e passa a aparecer na lista, mas ainda não está habilitado:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_07.jpg" alt="jboss_as_mysql_07" /></p>

<p>Antes de habilitá-lo, tornando-o assim disponível para conexão, vamos permitir que esse datasource seja gerenciado pela API de transações do Java (<a href="http://www.oracle.com/technetwork/java/javaee/jta/index.html">Java Transaction API</a>, ou JTA). Selecione-o na lista e, descendo na página, clique na aba “Connection”. Perceba que a JTA está desabilitada para esse datasource. Clique em “Edit” para alterar isso:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_08.jpg" alt="jboss_as_mysql_08" /></p>

<p>Marque as duas últimas opções e clique em “Save”:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_09.jpg" alt="jboss_as_mysql_09" /></p>

<p>Agora a JTA está habilitada:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_10.jpg" alt="jboss_as_mysql_10" /></p>

<p>Agora sim vamos habilitar o datasource: ainda com ele selecionado, clique no botão “Enable”, acima da lista. O datasource é então habilitado:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_11.jpg" alt="jboss_as_mysql_11" /></p>

<p>Ainda com o datasource selecionado na lista e a aba “Connection” aberta na parte de baixo, clique no botão “Test Connection”. Se você forneceu os dados corretamente, o servidor de aplicação conseguirá estabelecer uma conexão com o banco de dados, e a seguinte mensagem será exibida:</p>

<p><img src="http://vinyanalista.github.io/files/2012/07/jboss_as_mysql_12.jpg" alt="jboss_as_mysql_12" /></p>

<p>Da parte do servidor está tudo OK. Agora é só configurar a aplicação para utilizar o datasource.</p>

<h3 id="configurao-da-aplicao">Configuração da aplicação</h3>

<p>Agora nós precisamos configurar nossa aplicação para se comunicar com a base de dados utilizando o datasource configurado no servidor de aplicação. O arquivo central da configuração da JPA (<a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbpy.html">Java Persistence API</a>) no projeto, o “META-INF/persistence.xml”, vai sofrer algumas alterações. Observe as linhas destacadas:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;persistence</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/persistence&quot;</span>
   <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
   <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span>
   <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;persistence-unit</span> <span class="na">name=</span><span class="s">&quot;TestePU&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;provider&gt;</span>org.hibernate.ejb.HibernatePersistence<span class="nt">&lt;/provider&gt;</span>
      <span class="nt">&lt;jta-data-source&gt;</span>java:/teste<span class="nt">&lt;/jta-data-source&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="na">value=</span><span class="s">&quot;create-drop&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hibernate.show_sql&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
   <span class="nt">&lt;/persistence-unit&gt;</span>
<span class="nt">&lt;/persistence&gt;</span></code></pre></div>

<p>Observe que estou utilizando o <a href="http://www.hibernate.org/">Hibernate</a> como implementação JPA, já que estamos utilizando o JBoss AS como servidor de aplicação.</p>

<p>No código-fonte da aplicação, sempre for necessário um <a href="http://docs.oracle.com/javaee/6/api/javax/persistence/EntityManager.html">EntityManager</a> para <a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbqw.html">manusear entidades JPA</a>, você pode solicitar ao servidor de aplicação que injete-o (isso significa que você não precisa criar o objeto manualmente, o servidor de aplicação cria o objeto para você) anotando sua variável com <a href="http://docs.oracle.com/javaee/6/api/javax/persistence/PersistenceContext.html">@PersistenceContext</a> e especificando o nome da persistence-unit, como definida no arquivo “META-INF/persistence.xml”:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@PersistenceContext</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;TestePU&quot;</span><span class="o">)</span>
<span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span></code></pre></div>

<p>Se sua aplicação possui apenas uma persistence-unit, essa informação pode ser omitida:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@PersistenceContext</span>
<span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span></code></pre></div>

<h3 id="aplicao-de-exemplo">Aplicação de exemplo</h3>

<p>Uma boa pedida é escolher uma das <a href="http://www.jboss.org/jdf/quickstarts/jboss-as-quickstart/">aplicações de exemplo do JBoss AS</a>, alterar suas configurações e executá-la. No <a href="/2012/07/18/apresentando-o-servidor-de-aplicacao-jboss-as-7.html">post anterior</a>, nós compilamos, empacotamos, implantamos e executamos a aplicação de exemplo <a href="http://www.jboss.org/jdf/quickstarts/jboss-as-quickstart/helloworld-jsf/">helloworld-jsf</a>. Vou aproveitar o arquivo que já baixei e extraí naquele post, mas aqui vamos utilizar a aplicação <a href="http://www.jboss.org/jdf/quickstarts/jboss-as-quickstart/greeter/">greeter</a>.</p>

<p>Entre na pasta da aplicação (no meu caso, “/home/vinicius/jboss-jdf-jboss-as-quickstart-8505020/greeter/”), exclua o arquivo “greeter-quickstart-ds.xml” que está na pasta “src/main/webapp/WEB-INF/” e altere o arquivo “persistence.xml” dentro da pasta “src/main/resources/META-INF/” para que tenha o conteúdo acima.</p>

<p>Pronto! Agora é só implantar a aplicação com o <a href="http://maven.apache.org/">Maven</a> (caso você não tenha o Maven em seu computador, leia <a href="http://www.vinyanalista.com.br/blog/2012/07/18/instalacao-do-apache-maven/">esse post</a>):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mvn package jboss-as:deploy</code></pre></div>

<p>Se tudo ocorrer conforme o esperado, a aplicação de exemplo poderá ser acessada através do endereço “<a href="http://localhost:8080/jboss-as-greeter/">http://localhost:8080/jboss-as-greeter/</a>“.</p>

<h3 id="dica-aos-usurios-de-postgresql">Dica aos usuários de PostgreSQL</h3>

<p>As instruções fornecidas aqui podem ser aplicadas sem maiores problemas a outros bancos de dados. Veja, por exemplo, essa página que ensina <a href="http://blog.xebia.com/2011/07/19/developing-a-jpa-application-on-jboss-as-7/">como configurar um datasource do PostgreSQL no JBoss AS</a>.</p>

<p>Os passos são bastante parecidos, as diferenças ficam por conta do driver JDBC que será implantado (<a href="http://jdbc.postgresql.org/">clique aqui para ir ao site oficial do driver JDBC do PostgreSQL</a>) e do endereço JDBC informado na configuração do datasource (no exemplo desse link, ele informou “jdbc:postgresql://localhost:5432/library”, perceba que é parecido com o endereço que usamos aqui).</p>

<p>Bem, pessoal, vou ficando por aqui, espero que tenham gostado… até a próxima!</p>

    </div><!-- .blog-post-conteudo -->
</div><!-- .blog-post -->
                </div><!-- #blog-principal -->
                <div class="col-sm-4" id="blog-lateral">
                    <div class="panel panel-default" id='sobre'>
    <div class="panel-heading">
        <h4>Sobre mim</h4>
    </div>
    <div class="panel-body">
        <p>
        Etiam porta <em>sem malesuada magna</em> mollis euismod. Cras mattis consectetur purus sit amet fermentum. Aenean lacinia bibendum nulla sed consectetur.
    </p>
    </div>
</div>

<div class="panel panel-default" id='arquivos'>
    <div class="panel-heading">
        <h4>Arquivos</h4>
    </div>
    <div class="panel-body">
        <ol class="list-unstyled">
            <li>
                <a href="#">March 2014</a>
            </li>
            <li>
                <a href="#">February 2014</a>
            </li>
            <li>
                <a href="#">January 2014</a>
            </li>
            <li>
                <a href="#">December 2013</a>
            </li>
            <li>
                <a href="#">November 2013</a>
            </li>
            <li>
                <a href="#">October 2013</a>
            </li>
            <li>
                <a href="#">September 2013</a>
            </li>
            <li>
                <a href="#">August 2013</a>
            </li>
            <li>
                <a href="#">July 2013</a>
            </li>
            <li>
                <a href="#">June 2013</a>
            </li>
            <li>
                <a href="#">May 2013</a>
            </li>
            <li>
                <a href="#">April 2013</a>
            </li>
        </ol>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h4>Elsewhere</h4>
    </div>
    <div class="panel-body">
        <ol class="list-unstyled">
            <li>
                <a href="https://facebook.com/vinyanalista">Facebook</a>
            </li>
            <li>
                <a href="https://github.com/vinyanalista">GitHub</a>
            </li>
            <li>
                <a href="https://twitter.com/vinyanalista">Twitter</a>
            </li>
        </ol>
    </div>
</div>
                </div><!-- #blog-lateral -->
            </div>
        </div>
        <footer class="footer">
    <div class="container text-center">
        Copyright © 2015. <a href='#sobre'>Antônio Vinícius Menezes Medeiros</a>. Todos os direitos reservados. Blog construído sobre o <a href="http://jekyllrb.com/" target='_blank'>Jekyll</a>. Tema <a href="https://bootswatch.com/paper/" target='_blank'>Paper</a>.
    </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/lib/jquery/1.11.3/jquery-1.11.3.min.js"></script>
<script src="/lib/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/lib/bootstrap/3.3.4/js/ie10-viewport-bug-workaround.js"></script>
    </body>
</html>